<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>记忆拼图：嫚嫚的爱情故事</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            love: {
              light: '#FFD7E5',
              DEFAULT: '#FF6B9B',
              dark: '#FF1493'
            }
          },
          fontFamily: {
            love: ['"Comic Sans MS"', 'cursive', 'sans-serif']
          }
        }
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-flip {
        perspective: 1000px;
        transform-style: preserve-3d;
      }
      .card-front, .card-back {
        backface-visibility: hidden;
        transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
      }
      .card-back {
        transform: rotateY(180deg);
      }
      .card-flipped .card-front {
        transform: rotateY(180deg);
      }
      .card-flipped .card-back {
        transform: rotateY(0deg);
      }
      .heart-beat {
        animation: heartBeat 1s infinite alternate;
      }
      .celebration {
        animation: celebration 1s ease-out;
      }
    }
    
    @keyframes heartBeat {
      0% { transform: scale(1); }
      100% { transform: scale(1.1); }
    }
    
    @keyframes celebration {
      0% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.2); opacity: 0.8; }
      100% { transform: scale(1); opacity: 1; }
    }
    
    /* 背景爱心效果 */
    .heart-bg {
      position: absolute;
      width: 20px;
      height: 20px;
      opacity: 0;
      background-color: #FF6B9B;
      transform: rotate(45deg);
      animation: floatHeart 8s linear forwards;
    }
    
    .heart-bg:before, .heart-bg:after {
      content: '';
      width: 20px;
      height: 20px;
      background-color: #FF6B9B;
      border-radius: 50%;
      position: absolute;
    }
    
    .heart-bg:before {
      top: -10px;
      left: 0;
    }
    
    .heart-bg:after {
      top: 0;
      left: -10px;
    }
    
    @keyframes floatHeart {
      0% {
        transform: rotate(45deg) translateY(0) scale(0.3);
        opacity: 0;
      }
      10% {
        opacity: 0.8;
      }
      90% {
        opacity: 0.8;
      }
      100% {
        transform: rotate(45deg) translateY(-100vh) scale(0.3);
        opacity: 0;
      }
    }
  </style>
</head>
<body class="bg-gradient-to-br from-love-light to-white min-h-screen font-love overflow-x-hidden">
  <!-- 背景爱心效果 -->
  <div id="heart-bg-container" class="fixed inset-0 pointer-events-none z-0"></div>
  
  <!-- 游戏容器 -->
  <div id="game-container" class="relative w-full min-h-screen flex flex-col items-center justify-center z-10">
    
    <!-- 欢迎界面 -->
    <div id="welcome-screen" class="absolute inset-0 flex flex-col items-center justify-center bg-white/80 backdrop-blur-sm z-30">
      <div class="text-center p-8 rounded-2xl bg-white shadow-2xl max-w-md w-full mx-4 transform transition-all duration-500 hover:shadow-love/30">
        <h1 class="text-[clamp(2.5rem,8vw,4rem)] font-bold text-transparent bg-clip-text bg-gradient-to-r from-love-dark to-love heart-beat mb-6">
          记忆拼图：<br>小仪嫚的爱情故事
        </h1>
        <p class="text-gray-600 text-lg mb-8">
          亲爱的嫚嫚，这是专属你的记忆拼图游戏！<br>测试你们的默契，找出配对的图片。
        </p>
        
        <!-- 难度选择 -->
        <div class="border-2 border-dashed border-love rounded-lg p-4 mb-6">
          <h3 class="text-xl font-semibold text-love-dark mb-4">选择难度</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
            <button class="difficulty-btn bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-love hover:text-white transition-colors" data-rows="3" data-cols="4">
              简单 (3×4)
            </button>
            <button class="difficulty-btn bg-love text-white py-2 px-4 rounded-lg shadow-md" data-rows="4" data-cols="4">
              中等 (4×4)
            </button>
            <button class="difficulty-btn bg-gray-200 text-gray-700 py-2 px-4 rounded-lg hover:bg-love hover:text-white transition-colors" data-rows="4" data-cols="5">
              困难 (4×5)
            </button>
          </div>
        </div>
        
        <!-- 图片上传区域 -->
        <div class="border-2 border-dashed border-love rounded-lg p-4 mb-6">
          <h3 class="text-xl font-semibold text-love-dark mb-4">上传你们的照片</h3>
          <p class="text-gray-600 text-sm mb-4">上传2-10张图片，我们会用它们来创建拼图。</p>
          
          <div class="flex justify-center mb-4">
            <label for="image-upload" class="bg-love text-white py-2 px-6 rounded-full cursor-pointer hover:bg-love-dark transition-colors">
              <i class="fa fa-upload mr-2"></i> 选择图片
            </label>
            <input id="image-upload" type="file" accept="image/*" multiple class="hidden" />
          </div>
          
          <div id="image-preview-container" class="grid grid-cols-4 gap-2 max-h-48 overflow-y-auto">
            <!-- 图片预览将在这里动态生成 -->
          </div>
        </div>
        
        <div class="flex flex-col space-y-4">
          <button id="start-game-btn" class="bg-gradient-to-r from-love-dark to-love text-white py-4 px-10 rounded-full text-xl font-semibold shadow-lg hover:shadow-xl transform transition-all duration-300 hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-love-dark">
            开始游戏 <i class="fa fa-heart ml-2"></i>
          </button>
          <button id="how-to-play-btn" class="bg-gray-200 text-gray-700 py-4 px-10 rounded-full text-xl font-semibold shadow-lg hover:shadow-xl transform transition-all duration-300 hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400">
            游戏规则 <i class="fa fa-question-circle ml-2"></i>
          </button>
        </div>
      </div>
    </div>
    
    <!-- 游戏规则界面 -->
    <div id="rules-screen" class="absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-40 hidden">
      <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 transform transition-all duration-500">
        <h2 class="text-2xl font-bold text-love-dark mb-4">游戏规则</h2>
        <ul class="space-y-3 text-gray-700 mb-6">
          <li class="flex items-start">
            <i class="fa fa-heart text-love mt-1 mr-3"></i>
            <span>游戏有两位玩家：玩家1（蓝色）和仪嫚（粉色）</span>
          </li>
          <li class="flex items-start">
            <i class="fa fa-heart text-love mt-1 mr-3"></i>
            <span>轮流翻牌，每次翻两张，找出相同的图片</span>
          </li>
          <li class="flex items-start">
            <i class="fa fa-heart text-love mt-1 mr-3"></i>
            <span>如果找到配对，玩家可以继续翻牌</span>
          </li>
          <li class="flex items-start">
            <i class="fa fa-heart text-love mt-1 mr-3"></i>
            <span>如果未找到配对，轮到另一位玩家</span>
          </li>
          <li class="flex items-start">
            <i class="fa fa-heart text-love mt-1 mr-3"></i>
            <span>游戏结束时，配对最多的玩家获胜</span>
          </li>
        </ul>
        <button id="close-rules-btn" class="w-full bg-gradient-to-r from-love-dark to-love text-white py-3 px-6 rounded-full text-lg font-semibold shadow-lg hover:shadow-xl transform transition-all duration-300 hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-love-dark">
          我明白了
        </button>
      </div>
    </div>
    
    <!-- 游戏界面 -->
    <div id="game-screen" class="absolute inset-0 hidden flex flex-col items-center justify-center">
      <!-- 游戏信息 -->
      <div class="w-full max-w-5xl flex justify-between items-center mb-6 px-4">
        <div class="flex items-center">
          <div id="player1-indicator" class="w-6 h-6 rounded-full bg-blue-500 mr-3"></div>
          <div>
            <div class="font-bold">玩家1</div>
            <div class="text-sm">配对: <span id="player1-score">0</span></div>
          </div>
        </div>
        
        <div class="text-center">
          <div class="text-lg font-bold" id="current-turn">玩家1回合</div>
          <div class="text-sm" id="turn-counter">第 1 回合</div>
          <div class="text-xs text-gray-500 mt-1" id="difficulty-display">难度: 中等 (4×4)</div>
        </div>
        
        <div class="flex items-center">
          <div>
            <div class="font-bold text-right">仪嫚</div>
            <div class="text-sm text-right">配对: <span id="player2-score">0</span></div>
          </div>
          <div id="player2-indicator" class="w-6 h-6 rounded-full bg-love ml-3"></div>
        </div>
      </div>
      
      <!-- 卡片网格 -->
      <div id="card-grid" class="grid grid-cols-4 gap-3 max-w-5xl w-full px-4">
        <!-- 卡片将通过JavaScript动态生成 -->
      </div>
      
      <!-- 游戏控制 -->
      <div class="mt-8 flex space-x-4">
        <button id="restart-game-btn" class="bg-gray-200 text-gray-700 py-3 px-6 rounded-full text-lg font-semibold shadow-lg hover:shadow-xl transform transition-all duration-300 hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-400">
          重新开始 <i class="fa fa-refresh ml-2"></i>
        </button>
        <button id="quit-game-btn" class="bg-love text-white py-3 px-6 rounded-full text-lg font-semibold shadow-lg hover:shadow-xl transform transition-all duration-300 hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-love-dark">
          退出游戏 <i class="fa fa-sign-out ml-2"></i>
        </button>
      </div>
    </div>
    
    <!-- 游戏结束界面 -->
    <div id="game-over-screen" class="absolute inset-0 flex items-center justify-center bg-black/60 backdrop-blur-sm z-40 hidden">
      <div class="bg-white rounded-2xl shadow-2xl p-8 max-w-md w-full mx-4 text-center transform transition-all duration-500">
        <h2 class="text-3xl font-bold text-love-dark mb-4">游戏结束！</h2>
        <p class="text-lg mb-2">最终比分</p>
        <div class="flex justify-center space-x-8 mb-6">
          <div class="text-center">
            <div class="font-bold text-blue-500">聂老公1</div>
            <div class="text-2xl font-bold" id="final-player1-score">0</div>
          </div>
          <div class="text-center">
            <div class="font-bold text-love">嫚嫚妻</div>
            <div class="text-2xl font-bold" id="final-player2-score">0</div>
          </div>
        </div>
        <p class="text-xl font-bold mb-6" id="winner-message"></p>
        <button id="play-again-btn" class="bg-gradient-to-r from-love-dark to-love text-white py-4 px-10 rounded-full text-xl font-semibold shadow-lg hover:shadow-xl transform transition-all duration-300 hover:-translate-y-1 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-love-dark">
          再玩一次 <i class="fa fa-heart ml-2"></i>
        </button>
      </div>
    </div>
  </div>

  <script>
    // 游戏配置
    const config = {
      rows: 4,
      cols: 4,
      // 默认示例图片，可替换为你们的照片
      defaultImages: [
        'https://picsum.photos/seed/couple1/200/200',
        'https://picsum.photos/seed/couple2/200/200',
        'https://picsum.photos/seed/couple3/200/200',
        'https://picsum.photos/seed/couple4/200/200',
        'https://picsum.photos/seed/couple5/200/200',
        'https://picsum.photos/seed/couple6/200/200',
        'https://picsum.photos/seed/couple7/200/200',
        'https://picsum.photos/seed/couple8/200/200',
        'https://picsum.photos/seed/couple9/200/200',
        'https://picsum.photos/seed/couple10/200/200'
      ],
      cardBack: 'https://picsum.photos/seed/cardback/200/200'
    };
    
    // 游戏状态
    const gameState = {
      currentPlayer: 1,
      turn: 1,
      player1Score: 0,
      player2Score: 0,
      flippedCards: [],
      matchedCards: [],
      gameOver: false,
      cards: [],
      uploadedImages: []
    };
    
    // DOM元素
    const welcomeScreen = document.getElementById('welcome-screen');
    const rulesScreen = document.getElementById('rules-screen');
    const gameScreen = document.getElementById('game-screen');
    const gameOverScreen = document.getElementById('game-over-screen');
    const startGameBtn = document.getElementById('start-game-btn');
    const howToPlayBtn = document.getElementById('how-to-play-btn');
    const closeRulesBtn = document.getElementById('close-rules-btn');
    const restartGameBtn = document.getElementById('restart-game-btn');
    const quitGameBtn = document.getElementById('quit-game-btn');
    const playAgainBtn = document.getElementById('play-again-btn');
    const cardGrid = document.getElementById('card-grid');
    const currentTurn = document.getElementById('current-turn');
    const turnCounter = document.getElementById('turn-counter');
    const player1Score = document.getElementById('player1-score');
    const player2Score = document.getElementById('player2-score');
    const finalPlayer1Score = document.getElementById('final-player1-score');
    const finalPlayer2Score = document.getElementById('final-player2-score');
    const winnerMessage = document.getElementById('winner-message');
    const player1Indicator = document.getElementById('player1-indicator');
    const player2Indicator = document.getElementById('player2-indicator');
    const heartBgContainer = document.getElementById('heart-bg-container');
    const imageUpload = document.getElementById('image-upload');
    const imagePreviewContainer = document.getElementById('image-preview-container');
    const difficultyBtns = document.querySelectorAll('.difficulty-btn');
    const difficultyDisplay = document.getElementById('difficulty-display');
    
    // 初始化事件监听
    function initEventListeners() {
      startGameBtn.addEventListener('click', startGame);
      howToPlayBtn.addEventListener('click', showRules);
      closeRulesBtn.addEventListener('click', hideRules);
      restartGameBtn.addEventListener('click', restartGame);
      quitGameBtn.addEventListener('click', quitGame);
      playAgainBtn.addEventListener('click', playAgain);
      imageUpload.addEventListener('change', handleImageUpload);
      
      // 难度选择
      difficultyBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          // 移除所有按钮的选中状态
          difficultyBtns.forEach(b => {
            b.classList.remove('bg-love', 'text-white', 'shadow-md');
            b.classList.add('bg-gray-200', 'text-gray-700');
          });
          
          // 设置当前按钮为选中状态
          btn.classList.remove('bg-gray-200', 'text-gray-700');
          btn.classList.add('bg-love', 'text-white', 'shadow-md');
          
          // 更新配置
          config.rows = parseInt(btn.dataset.rows);
          config.cols = parseInt(btn.dataset.cols);
        });
      });
    }
    
    // 处理图片上传
    function handleImageUpload(e) {
      const files = e.target.files;
      if (!files.length) return;
      
      // 清空现有预览
      imagePreviewContainer.innerHTML = '';
      gameState.uploadedImages = [];
      
      // 处理每个文件
      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        if (!file.type.startsWith('image/')) continue;
        
        const reader = new FileReader();
        reader.onload = function(e) {
          // 添加到上传的图片数组
          gameState.uploadedImages.push(e.target.result);
          
          // 创建预览元素
          const preview = document.createElement('div');
          preview.className = 'relative';
          
          const img = document.createElement('img');
          img.src = e.target.result;
          img.className = 'w-full h-16 object-cover rounded-md';
          
          const removeBtn = document.createElement('button');
          removeBtn.innerHTML = '<i class="fa fa-times-circle"></i>';
          removeBtn.className = 'absolute top-0 right-0 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center opacity-80 hover:opacity-100 transition-opacity';
          removeBtn.onclick = function() {
            // 从DOM中移除
            preview.remove();
            // 从数组中移除
            const index = gameState.uploadedImages.indexOf(e.target.result);
            if (index !== -1) {
              gameState.uploadedImages.splice(index, 1);
            }
          };
          
          preview.appendChild(img);
          preview.appendChild(removeBtn);
          imagePreviewContainer.appendChild(preview);
        };
        
        reader.readAsDataURL(file);
      }
    }
    
    // 显示规则
    function showRules() {
      rulesScreen.classList.remove('hidden');
    }
    
    // 隐藏规则
    function hideRules() {
      rulesScreen.classList.add('hidden');
    }
    
    // 开始游戏
    function startGame() {
      welcomeScreen.classList.add('hidden');
      gameScreen.classList.remove('hidden');
      
      // 更新难度显示
      let difficultyText;
      if (config.rows === 3 && config.cols === 4) {
        difficultyText = '简单 (3×4)';
      } else if (config.rows === 4 && config.cols === 4) {
        difficultyText = '中等 (4×4)';
      } else if (config.rows === 4 && config.cols === 5) {
        difficultyText = '困难 (4×5)';
      }
      difficultyDisplay.textContent = `难度: ${difficultyText}`;
      
      // 初始化游戏状态
      gameState.currentPlayer = 1;
      gameState.turn = 1;
      gameState.player1Score = 0;
      gameState.player2Score = 0;
      gameState.flippedCards = [];
      gameState.matchedCards = [];
      gameState.gameOver = false;
      
      // 更新UI
      updateTurnIndicator();
      player1Score.textContent = gameState.player1Score;
      player2Score.textContent = gameState.player2Score;
      turnCounter.textContent = `第 ${gameState.turn} 回合`;
      
      // 创建卡片
      createCards();
      
      // 开始背景爱心动画
      startHeartBackground();
    }
    
    // 创建卡片
    function createCards() {
      // 清空卡片网格
      cardGrid.innerHTML = '';
      
      // 计算需要的图片数量
      const totalCards = config.rows * config.cols;
      const uniqueImagesNeeded = Math.floor(totalCards / 2);
      
      // 准备卡片数据
      let images = [];
      
      // 如果有上传的图片，优先使用
      if (gameState.uploadedImages.length > 0) {
        // 混洗上传的图片
        const shuffledUploads = [...gameState.uploadedImages];
        shuffleArray(shuffledUploads);
        
        // 使用上传的图片，如果不够则用默认图片补足
        images = shuffledUploads.slice(0, uniqueImagesNeeded);
        
        // 如果上传的图片不够，用默认图片补足
        if (images.length < uniqueImagesNeeded) {
          const remaining = uniqueImagesNeeded - images.length;
          images = [...images, ...config.defaultImages.slice(0, remaining)];
        }
      } else {
        // 没有上传图片，使用默认图片
        images = config.defaultImages.slice(0, uniqueImagesNeeded);
      }
      
      // 复制图片形成配对
      const pairedImages = [...images, ...images];
      
      // 打乱顺序
      shuffleArray(pairedImages);
      
      // 设置网格列数
      cardGrid.style.gridTemplateColumns = `repeat(${config.cols}, 1fr)`;
      
      // 创建卡片元素
      for (let i = 0; i < totalCards; i++) {
        const card = document.createElement('div');
        card.className = 'card-flip cursor-pointer';
        card.dataset.index = i;
        card.dataset.image = pairedImages[i];
        
        // 卡片正面
        const cardFront = document.createElement('div');
        cardFront.className = 'card-front absolute inset-0 bg-white rounded-lg shadow-md flex items-center justify-center';
        cardFront.innerHTML = `<img src="${config.cardBack}" alt="卡片背面" class="w-full h-full object-cover rounded-lg">`;
        
        // 卡片背面（图片）
        const cardBack = document.createElement('div');
        cardBack.className = 'card-back absolute inset-0 bg-white rounded-lg shadow-md flex items-center justify-center';
        cardBack.innerHTML = `<img src="${pairedImages[i]}" alt="卡片正面" class="w-full h-full object-cover rounded-lg">`;
        
        // 添加卡片到网格
        card.appendChild(cardFront);
        card.appendChild(cardBack);
        cardGrid.appendChild(card);
        
        // 添加点击事件
        card.addEventListener('click', () => flipCard(card));
      }
      
      // 保存卡片引用
      gameState.cards = document.querySelectorAll('.card-flip');
    }
    
    // 翻牌
    function flipCard(card) {
      // 如果游戏结束、卡片已匹配或已翻开，则忽略点击
      if (gameState.gameOver || 
          gameState.matchedCards.includes(card) || 
          gameState.flippedCards.includes(card)) {
        return;
      }
      
      // 翻转卡片
      card.classList.add('card-flipped');
      gameState.flippedCards.push(card);
      
      // 检查是否翻了两张卡片
      if (gameState.flippedCards.length === 2) {
        setTimeout(checkMatch, 1000);
      }
    }
    
    // 检查匹配
    function checkMatch() {
      const [card1, card2] = gameState.flippedCards;
      
      // 如果两张卡片图片相同，则匹配成功
      if (card1.dataset.image === card2.dataset.image) {
        // 标记为已匹配
        gameState.matchedCards.push(card1, card2);
        
        // 添加匹配成功动画
        card1.classList.add('celebration');
        card2.classList.add('celebration');
        
        // 增加当前玩家分数
        if (gameState.currentPlayer === 1) {
          gameState.player1Score++;
          player1Score.textContent = gameState.player1Score;
        } else {
          gameState.player2Score++;
          player2Score.textContent = gameState.player2Score;
        }
        
        // 检查游戏是否结束
        if (gameState.matchedCards.length === gameState.cards.length) {
          setTimeout(endGame, 1000);
          return;
        }
        
        // 玩家继续回合
        gameState.flippedCards = [];
      } else {
        // 不匹配，翻回
        setTimeout(() => {
          card1.classList.remove('card-flipped');
          card2.classList.remove('card-flipped');
          gameState.flippedCards = [];
          
          // 切换玩家
          gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
          gameState.turn++;
          updateTurnIndicator();
        }, 500);
      }
    }
    
    // 更新回合指示器
    function updateTurnIndicator() {
      currentTurn.textContent = `玩家${gameState.currentPlayer === 1 ? '1' : '嫚总'}回合`;
      turnCounter.textContent = `第 ${gameState.turn} 回合`;
      
      // 更新玩家指示器样式
      if (gameState.currentPlayer === 1) {
        player1Indicator.classList.add('heart-beat');
        player2Indicator.classList.remove('heart-beat');
      } else {
        player2Indicator.classList.add('heart-beat');
        player1Indicator.classList.remove('heart-beat');
      }
    }
    
    // 结束游戏
    function endGame() {
      gameState.gameOver = true;
      
      // 显示游戏结束界面
      finalPlayer1Score.textContent = gameState.player1Score;
      finalPlayer2Score.textContent = gameState.player2Score;
      
      // 确定获胜者
      if (gameState.player1Score > gameState.player2Score) {
        winnerMessage.textContent = '🎉 聂老公获胜！🎉';
      } else if (gameState.player2Score > gameState.player1Score) {
        winnerMessage.textContent = `🎉 小宝贝仪嫚获胜！🎉`;
      } else {
        winnerMessage.textContent = '平局呀！你们真是心有灵犀~';
      }
      
      gameOverScreen.classList.remove('hidden');
    }
    
    // 重新开始游戏
    function restartGame() {
      // 重置卡片状态
      gameState.cards.forEach(card => {
        card.classList.remove('card-flipped', 'celebration');
      });
      
      // 重新开始
      gameState.currentPlayer = 1;
      gameState.turn = 1;
      gameState.flippedCards = [];
      gameState.matchedCards = [];
      gameState.gameOver = false;
      
      // 更新UI
      updateTurnIndicator();
      player1Score.textContent = gameState.player1Score;
      player2Score.textContent = gameState.player2Score;
      
      // 重新洗牌
      createCards();
    }
    
    // 退出游戏
    function quitGame() {
      gameScreen.classList.add('hidden');
      welcomeScreen.classList.remove('hidden');
      
      // 停止背景爱心动画
      stopHeartBackground();
    }
    
    // 再玩一次
    function playAgain() {
      gameOverScreen.classList.add('hidden');
      restartGame();
    }
    
    // 打乱数组
    function shuffleArray(array) {
      for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
      }
      return array;
    }
    
    // 创建背景爱心
    function createHeart() {
      const heart = document.createElement('div');
      heart.className = 'heart-bg';
      
      // 随机位置和大小
      const x = Math.random() * window.innerWidth;
      const size = 10 + Math.random() * 30;
      
      heart.style.left = `${x}px`;
      heart.style.width = `${size}px`;
      heart.style.height = `${size}px`;
      
      // 随机颜色
      const hue = 340 + Math.random() * 40; // 粉色系
      const lightness = 50 + Math.random() * 30; // 50-80%
      heart.style.backgroundColor = `hsl(${hue}, 100%, ${lightness}%)`;
      
      // 随机动画延迟
      heart.style.animationDelay = `${Math.random() * 10}s`;
      
      // 设置伪元素颜色
      const style = document.createElement('style');
      style.textContent = `
        .heart-bg:before, .heart-bg:after {
          background-color: hsl(${hue}, 100%, ${lightness}%);
        }
      `;
      heart.appendChild(style);
      
      // 添加到容器
      heartBgContainer.appendChild(heart);
      
      // 动画结束后移除
      setTimeout(() => {
        if (heart.parentNode === heartBgContainer) {
          heartBgContainer.removeChild(heart);
        }
      }, 8000);
    }
    
    // 开始背景爱心动画
    let heartInterval;
    function startHeartBackground() {
      // 先清空现有爱心
      heartBgContainer.innerHTML = '';
      
      // 每隔一段时间创建新爱心
      heartInterval = setInterval(createHeart, 300);
      
      // 初始创建一些爱心
      for (let i = 0; i < 10; i++) {
        setTimeout(createHeart, i * 100);
      }
    }
    
    // 停止背景爱心动画
    function stopHeartBackground() {
      clearInterval(heartInterval);
      heartBgContainer.innerHTML = '';
    }
    
    // 初始化游戏
    initEventListeners();
  </script>
</body>
</html>